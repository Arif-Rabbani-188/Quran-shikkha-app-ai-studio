<!DOCTYPE html>
<html>
<head>
    <title>PWA Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>PWA Installation Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // Test Service Worker
        if ('serviceWorker' in navigator) {
            addResult('✓ Service Worker support detected');
            
            navigator.serviceWorker.register('/sw.js')
                .then(reg => addResult('✓ Service Worker registered successfully'))
                .catch(err => addResult('✗ Service Worker registration failed: ' + err.message, 'error'));
        } else {
            addResult('✗ Service Worker not supported', 'error');
        }
        
        // Test Manifest
        const manifestLink = document.querySelector('link[rel="manifest"]');
        if (manifestLink) {
            addResult('✓ Manifest link found');
            
            fetch(manifestLink.href)
                .then(response => response.json())
                .then(manifest => {
                    addResult('✓ Manifest loaded successfully');
                    addResult(`App name: ${manifest.name || 'Not specified'}`);
                    addResult(`Icons: ${manifest.icons ? manifest.icons.length : 0} found`);
                })
                .catch(err => addResult('✗ Manifest loading failed: ' + err.message, 'error'));
        } else {
            addResult('✗ No manifest link found', 'error');
        }
        
        // Test Install Prompt
        let deferredPrompt = null;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            addResult('✓ Install prompt available');
            
            const installBtn = document.createElement('button');
            installBtn.textContent = 'Install App';
            installBtn.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(result => {
                    addResult(`Install prompt result: ${result.outcome}`);
                });
            };
            results.appendChild(installBtn);
        });
        
        // Test if already installed
        if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
            addResult('✓ App is running in standalone mode (installed)', 'success');
        } else {
            addResult('App is running in browser mode', 'warning');
        }
        
        // Test HTTPS
        if (location.protocol === 'https:' || location.hostname === 'localhost') {
            addResult('✓ HTTPS or localhost detected');
        } else {
            addResult('✗ HTTPS required for PWA features', 'error');
        }
    </script>
</body>
</html>